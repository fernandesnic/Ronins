
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

// --- TABELAS DE UTILIZADOR E VENDAS (Baseado em image_e9dfa7.png) ---

model User {
  id       String    @id @default(cuid()) // Agora o ID será gerado automaticamente
  nome     String
  email    String  @unique // Guardamos o email aqui por conveniência
  password String

  is_admin Boolean @default(false)
  is_socio Boolean @default(false)

  enderecos Endereco[] // Relação 1-para-N
  vendas   Venda[]   // Relação 1-para-N
  
  @@map("users")
}

model Endereco {
  id     Int    @id @default(autoincrement())
  cep    String
  estado String
  cidade String
  bairro String
  rua    String
  numero String

  // Relação 1-para-N com User (um usuário pode ter vários endereços)
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("enderecos")
}

model Produto {
  id        Int      @id @default(autoincrement())
  nome      String
  descricao String?
  // Adicione um campo para a imagem principal
  foto_principal String? 

  // RELAÇÃO: Um produto tem MUITAS variantes
  variacoes ProdutoVariacao[]

  @@map("produtos")
}

model ProdutoVariacao {
  id        Int     @id @default(autoincrement())
  tamanho   String? // "M", "G", "Unico"
  cor       String? // "Preto", "Branco"
  preco     Float   // O preço pode variar (ex: XXG é mais caro)
  estoque   Int     @default(0) // ESSENCIAL: Gerenciamento de estoque
  foto      String? // Foto específica da variante (ex: a camisa branca)
  
  // Relação de volta ao Pai
  produtoId Int
  produto   Produto @relation(fields: [produtoId], references: [id])

  // RelaÇÃO: Uma variante pode estar em muitos carrinhos
  vendas    ProdutoDaVenda[]

  @@map("produto_variacoes")
}

model Venda {
  id              Int      @id @default(autoincrement())
  forma_pagamento String
  preco_final     Float
  foi_entregue    Boolean  @default(false)
  criadoEm        DateTime @default(now())

  // Relação 1-para-N com Perfil
  userId String
  user   User   @relation(fields: [userId], references: [id])

  // Relação M-para-N com Produto
  produtos ProdutoDaVenda[]

  
  endereco_rua    String?
  endereco_numero String?
  endereco_bairro String?
  endereco_cidade String?
  endereco_estado String?
  endereco_cep    String?
  

  @@map("vendas")
}

model ProdutoDaVenda {
  quantidade Int

  venda_id Int
  venda    Venda @relation(fields: [venda_id], references: [id])
  produto_variacao_id Int
  variacao            ProdutoVariacao @relation(fields: [produto_variacao_id], references: [id])

  @@id([venda_id, produto_variacao_id]) // O ID composto agora usa a variacao_id
  @@map("produto_da_venda")
}



model Jogador {
  id            Int      @id @default(autoincrement())
  nome          String
  numero_camisa Int?
  classificacao String? // Ex: "2.5"
  nacionalidade String?
  idade         Int?
  foto          String?
  on_team       Boolean  @default(true)

  // Relações (como no seu ERD)
  premiacoes  Premiacao[]
  campeonatos ElencoDoCampeonato[]

  @@map("jogadores")
}

model Staff {
  id      Int      @id @default(autoincrement())
  nome    String
  funcao  String
  foto    String?
  on_team Boolean  @default(true)

  // Relação (como no seu ERD)
  campeonatos ElencoDoCampeonato[]

  @@map("staff")
}

model Premiacao {
  id        Int    @id @default(autoincrement())
  descricao String
  ano       Int

  // Relação 1-para-N com Jogador
  jogador_id Int
  jogador    Jogador @relation(fields: [jogador_id], references: [id])

  @@map("premiacoes")
}

model CampeonatoGanho {
  id    Int    @id @default(autoincrement())
  nome  String
  ano   Int
  foto String[]

  elenco ElencoDoCampeonato[]

  @@map("campeonatos_ganhos")
}

// Tabela "pivot" (join table) para Campeonato, Jogador e Staff
model ElencoDoCampeonato {
  id Int @id @default(autoincrement()) // É mais simples ter um ID próprio

  // Chave estrangeira para Campeonato
  campeonato_id Int
  campeonato    CampeonatoGanho @relation(fields: [campeonato_id], references: [id])

  // Chave estrangeira para Jogador (opcional, ? , pode ser um staff)
  jogador_id Int?
  jogador    Jogador? @relation(fields: [jogador_id], references: [id])

  // Chave estrangeira para Staff (opcional, ? , pode ser um staff)
  staff_id Int?
  staff    Staff? @relation(fields: [staff_id], references: [id])

  @@map("elenco_do_campeonato")
}

model Jogo {
  id              Int      @id @default(autoincrement())
  data            DateTime 
  time_adversario String
  local           String
  campeonato      String?

  @@map("jogos")
}

model Apoiadores {
  id Int @id @default(autoincrement())
  apoiador String
  meses Int
  is_active Boolean @default(true)

  @@map("apoiadores")
}

model ContatoMsg {
  id         Int      @id @default(autoincrement())
  nome       String
  email      String
  mensagem   String
  lido       Boolean  @default(false)
  criadoEm   DateTime @default(now())

  @@map("contato_msgs")
}

